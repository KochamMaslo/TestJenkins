/*
 Geospatial Portal JavaScript API
 A valid Geospatial Portal SDK license is required for customizing
 Geospatial Portal, GeoMedia WebMap, and/or ERDAS APOLLO.
 A valid product license is required to run each copy of Geospatial Portal,
 GeoMedia WebMap, and/or ERDAS APOLLO that has been customized using the
 Geospatial Portal SDK.
 ? 2013, 2014, 2015, 2016 Intergraph? Corporation and/or its affiliates.
 All Rights Reserved.
*/
(function(J,T){function sa(){n(console)&&typeof console.warn===t&&console.warn.apply(console,Array.prototype.slice.call(arguments))}function n(a){return typeof a!==E}function $(){for(var a=Array.prototype.slice.call(arguments),b=0,c=a.length;b<c;b++)if(n(a[b]))return!0;return!1}function ta(){for(var a=Array.prototype.slice.call(arguments),b=0,c=a.length;b<c;b++)if(!n(a[b]))return!1;return!0}function ua(){for(var a=[],b=0;36>b;b++)a[b]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);a[14]=
"4";a[19]="0123456789abcdef".substr(a[19]&3|8,1);a[8]=a[13]=a[18]=a[23]="-";return a.join("")}function g(a){if(ha[a])return ha[a];for(var b=a.split("."),c=J,d=0,e=b.length;d<e&&!(c=c[b[d]],typeof c===E);d++);return ha[a]=c}function L(){return!0}function ia(){var a=Array.prototype.slice.call(arguments);return function(b){return a.some(function(a){var d=a.value;a=b[a.key];return d instanceof RegExp?d.test(a):a===d})}}function va(a,b,c,d){g(C).create({name:"Membership",query:{action:a},body:{login:b,
password:c,remember:!1},includeCRS:!1,callback:function(a){g(M).checkExecutor(a,g(M).showError)&&(a=a.get_object(),a.error?g(M).showError(a.error):(a.success?g(ja).logIn(b):g(ja).logIn(null),g(p).notify(cb,{},null),typeof d===t&&d({username:b,result:a})))}}).invoke()}function db(a){function b(b){if(b){var d=Math.min(b[0].x,b[1].x),e=Math.max(b[2].x,b[3].x),f=Math.min(b[0].y,b[2].y);b=Math.max(b[1].y,b[3].y);d=new (g(wa))([d,f,e,b]);g(A).getRange(a.value)||g(A).setRange(a.value,d);var e=g(ca).get_mapStates(),
h;for(h in e)B.call(e,h)&&(f=e[h],f.get_fitAllRange(a.value)||f.set_fitAllRange(a.value,d.clone(),{onlyCurrentRange:!0}))}}a.west>=a.east||a.south>=a.north||g(A).transformPoints(g(A).WGS84Id,a.value,[{x:a.west,y:a.south},{x:a.west,y:a.north},{x:a.east,y:a.south},{x:a.east,y:a.north}],{round:!0},b,null)}function U(a){for(var b=a.transformer||function(a){return a},c=[],d=0,e=a.items.length;d<e;d++)a.predicate(a.items[d])&&c.push(b(a.items[d])),c=c.concat(U({items:a.items[d][a.childrenGetter]()||[],
predicate:a.predicate,childrenGetter:a.childrenGetter,transformer:b}));return c}function k(a,b,c){var d=g(da);d.writeVerbose("Firing ["+a+"]");!n(b)&&a===q&&d.writeVerbose("Errback not defined");typeof b===t&&b.call(null,c)}function V(a,b,c){var d=g(da);d.writeVerbose("Firing Event ["+a+"]");n(b)||d.writeVerbose("Handler not defined");typeof b===t&&b.call(null,c)}function xa(a){var b=a._priority,c=typeof b===N,b=[c?b:Infinity,c?b:-Infinity];a=a.get_legendItems()||[];for(var c=0,d=a.length;c<d;c++)var e=
xa(a[c]),b=[Math.min(b[0],e[0]),Math.max(b[1],e[1])];return b}function u(a){a=(a||{}).mapStateId||"map";return g(ca).findMapState(a)}function F(){var a=g(v).findByDefinitionName("Apollo");return 0>=a.length?null:a[0]}function ya(a){if(!a||typeof a.get_mapState!==t)return null;for(var b=a.get_mapState().get_mapControl().get_mapLayers(),c=0,d=b.length;c<d;c++)if(b[c].get_config().get_id()===a.get_id())return b[c];return null}function eb(a){a=a||{};var b=u(a).get_mapControl(),c=a.mapLayerName,d=a.mapLayerId;
a=a.mapServiceId;if(!b)return null;for(var b=b.get_mapLayers()||[],e=b.length-1;0<=e;e--){var f=b[e].get_config();if(f.get_mapService().get_id()===a&&!(n(c)&&f.get_name()!==c)&&!(n(d)&&f.get_id()!==d))return b[e]}return null}function za(a){a=a||{};var b=a.ids,c=a.names,d=a.transformer,e=a.mapServiceId,e=g(v).findMapService(e).get_legendItemDefinitions()||[],f=a.allowedTypes||[0],h={},k={},s;a=0;for(s=(c||[]).length;a<s;a++)h[c[a]]=1;a=0;for(s=(b||[]).length;a<s;a++)k[b[a]]=1;return U({items:e,predicate:function(a){return-1===
f.indexOf(a.get_type())?!1:!c&&!b||k[a.get_id()]||h[a.get_name()]},childrenGetter:"get_legendItemDefinitions",transformer:d})}function Aa(a,b){var c=[],d;for(d in a)if(B.call(a,d)&&typeof a[d]!==t){var e=a[d];typeof a[d]===O&&null!==a[d]&&(e=Aa(a[d]));c.push({Key:d,Value:e})}return c}function P(a){for(var b in Sys.Application._components)if(b.match(a))return Sys.Application._components[b];return null}function z(a,b,c,d){d=d||L;c&&z(a,c);if(a&&b&&typeof b===O)for(var e in b)B.call(b,e)&&d(b,e)&&(a[e]=
b[e]);return a}function aa(a,b){for(var c=b.split(".")||[],d=a,e=0,f=c.length;e<f;e++)if(!Object.hasOwnProperty.call(d,c[e])||!(d=d[c[e]]))return null;return d}function Ba(a){var b=u(a),c=b.get_mapControl().get_mapSize(),d=b.get_mapRange().getSize(),b=b.get_mapRange().getBottomLeft(),e=c.height-(a.y-b.y)*c.height/d.height;return{x:Math.round((a.x-b.x)*c.width/d.width),y:Math.round(e)}}function Ca(a){return typeof a===K?"'"+a+"'":a}function Da(a,b){b=b||"";for(var c=a.operands||[],d=c.length,e=0;e<
d;e++)if(typeof c[e].operator===K)b=Da(c[e],b),e!==d-1&&(b+=" "+a.operator+" ");else{switch(a.operator){case "AND":case "OR":break;case "BETWEEN":case "NOT BETWEEN":case "IN":case "NOT IN":b+=a.operands[0]+" "+a.operator+"(";b+=c.slice(1).map(Ca).join(",");b+=")";break;default:b+=a.operands[0]+" "+a.operator+" "+Ca(a.operands[1])}break}return b}function fb(a){a=JSON.parse(JSON.stringify(a));return W(a)}function Ea(a){return!Object.prototype.hasOwnProperty.call(a,"operator")&&!Object.prototype.hasOwnProperty.call(a,
"operands")}function ka(a){return[[null,null,null,"("]].concat(a).concat([[null,null,null,")"]])}function W(a){var b=[],c=a.operator,d=[[null,null,null,c]];a=a.operands||[];var e=a.length;if(1===e)b=b.concat(d).concat(W(a[0])),b=ka(b);else if(2===e)Ea(a[0])&&Ea(a[1])?(d=a[1],Array.isArray(d)&&(d=d.join(",")),b=b.concat([[a[0],c,d,null]])):b=b.concat(W(a[0])).concat(d).concat(W(a[1])),b=ka(b);else{for(var c=W({operator:c,operands:a.splice(0,2)}),f=2;f<e;f++)c=ka(c.concat(d).concat(W(a[f-2])));b=b.concat(c)}return b}
function Fa(a){var b=a.handler,c=a.transformargs,d=a.requestcompleted,e=a.httphandler,f=a.predicate,h=a.fallback,k=a.geometryFieldNames&&a.geometryFieldNames.map(function(a){return a.toLowerCase()});return function(a,r,l){g(ca).saveMapStates();if(r.legendItemDefinition){var m=r.legendItemDefinition.get_sourceLegendItemDefinition()||r.legendItemDefinition;r.skipRasterLayers=m.get_mapService().get_supportsDataEditing()||"undefined"!==typeof r.featureId&&"undefined"===typeof x&&"undefined"===typeof y;
r.mapServiceId=m.get_mapService().get_id();r.legendItemDefinitionKey=m.getKey()}r.requestEndpoint=e;r.wholeFeature=null;typeof f===t&&!f(r)?typeof h===t&&h(a,r,l):(typeof c===t&&(r=c(r)),r.geometryFieldsToSerialize=k,"InsertFeature"===r.action&&r.insertFeatureCallback?b({},r):(m=g(G).featureInfoRetriever.getFeatureInfo(r),typeof d===t?m.always(function(c){r.result=c;d(c)?b(c,r):h(a,r,l)}):m.always(b)))}}function Y(a){a=a||{};var b,c=null;typeof a.style===K?b=a.style:(c=a.style,b=a.defaultStyleName||
"default");return new (g(a.styleType||gb))(b,c)}function Ga(a,b,c){hb(a,b,function(){ib(a,b,c)})}function jb(a,b,c){Ga({featureIds:[a.featureId],featureClassId:a.featureClassId,bbox:a.bbox,force:a.forceFeatureClassesRefresh},function(a){k(m,b,a[0])},c)}function hb(a,b,c){var d=a.featureClassId,e=ea(d).get_mapService().get_id(),f=u(a).get_mapControl().get_mapLayers().filter(function(a){var b=a.get_config().get_mapService();return b&&b.get_id()===e&&a._featureCache&&a._featureCache[d]})[0];a=a.featureIds;
var h=[],g;if(!f||!(g=f._featureCache[d]))return k(q,c,{success:!1});for(var s in g)if(g.hasOwnProperty(s)&&g[s].feature&&(c=g[s].feature,-1<a.indexOf(c.getKey()[0])&&h.push(c),h.length===a.length))break;return k(m,b,h)}function kb(a){var b=new (g(lb))("FeatureId",mb);b.get_attributes().fid=a;return b}function ib(a,b,c){var d=a.featureClassId,e=a.featureIds,f=ea(d),h=f.get_mapService(),g=a.bboxPoints,s=a.forceFeatureClassesRefresh;a=function(a){if(!a||a.error)return k(q,c,{message:a||"Unknown error"});
a=a.findFeatureClass(d).get_features()||[];var f=[],h;for(h in a)if(B.call(a,h)&&-1<e.indexOf(a[h].getKey()[0])&&(f.push(a[h]),n(e)&&f.length===e.length))break;return k(m,b,f)};1===e.length?(g=kb(e[0]),h.queryFeatures(f,g,a)):h.getFeatureDataset([f],a,null,{bboxPoints:g,force:s})}function Ha(a){if(a.portalLegendItem){var b=a.portalLegendItem,c;a:{var d={legendItem:a.portalLegendItem,mapStateId:a.mapStateId};if(d&&!d.legendItem._parent){c=xa(d.legendItem);for(var d=u(d).get_mapLayerConfigs()||[],e=
0,f=d.length;e<f;e++)if(d[e]._firstLegendItemPriority===c[0]&&d[e]._lastLegendItemPriority===c[1]){c=d[e];break a}}c=null}this._={config:a,li:b,mlc:c}}}function la(a){a.portalMapService&&(this._={config:a,ms:a.portalMapService})}function H(a){this._={config:a,f:a.portalFeature,proxy:{featureId:a.featureId,featureClassId:a.featureClassId}}}function Ia(a){this._={config:a};if(a=a.portalSearchResult)this.point={x:a.point[1],y:a.point[0]},this.id=a.id,this.name=a.name,this.bbox=a.suggestedBBox,this.score=
a.score,this.index=a.index,this.serviceId=a.mapServiceId,this.serviceName=a.mapServiceName}function Ja(a){this._={config:a};if(a=a.portalSearchResult){this._actionMapping={wmts:"add_to_map_wmts",ecwp:"add_to_map_ecwp",wfs:"add_as_vector",wms:"add_to_map_wms"};var b=this.apollo={},c={temporalExtent:{temporalExtent:aa(a,"temporalExtent.extentValues")},spatialExtent:{width:aa(a,"spatialExtent.xExtent.size"),height:aa(a,"spatialExtent.yExtent.size"),resolutionX:aa(a,"spatialExtent.xExtent.resolution.string"),
resolutionY:aa(a,"spatialExtent.yExtent.resolution.string")}},d;for(d in a)Object.hasOwnProperty.call(a,d)&&(c[d]?z(b,c[d]):b[d]=a[d])}}function Ka(a,b,c){return function(d){if(d){var e=g(I),f=[],h,w=d.get_featureClasses()||{},s=a.format||"geojson",r;for(r in w)if(B.call(w,r)){var l=w[r];if(a.swapped){h=d;l=JSON.parse(JSON.stringify(l.serialize()));l=new (g(nb))(h,l);h=l.get_features()||{};var p=void 0;for(p in h)if(B.call(h,p)){var X=h[p].get_geometry();X&&X.swapCoordinates()}}h=e.getFeatureCollection(l);
switch(s){case "geojson":f.push(h);break;case "featureCollectionsData":f.push({geojson:h,featureClassId:l.get_id(),featureClassName:l._name||l.get_id()});break;default:return k(q,c,{success:!1,msg:"No specified format"})}}k(m,b,{success:!0,data:f})}else k(q,c,{success:!1,msg:"Data not found."})}}function La(a){return P("^"+(a||"DataWindow")+"$")||P("DataPanel$")}function ob(a){var b=[],c;for(c in a)if(B.call(a,c)){var d=a[c],e;for(e in d)if(B.call(d,e)){var f=d[e],h;for(h in f)b.push({featureId:h,
featureClassId:e,mapServiceId:c})}}return b}function Ma(a){this._={config:a.config,portalAnalysis:a.portalAnalysis}}function D(a){this._eventName=a.eventName;this._defaultHandlers=a.defaultHandlers||[];this._f={};this._decorator=a.decorator}function Q(a,b,c,d){return function(e){g(M).checkExecutor(e,g(M).showError)?(e=e.get_object(),e.error?(e.sessionExpired&&g(pb).resume(),k(q,b,{success:!1,message:e.error})):(e={success:!0,results:c(e)},typeof d===t&&(e=d(e)),k(m,a,e))):k(q,b,{success:!1})}}function Na(a,
b){return Q(a,b,function(a){return a.processes.map(function(a){return new Oa({portalApolloProcess:a})})})}function Pa(a,b,c,d){return Q(a,b,function(a){return a[c].map(function(a){return new Ja({portalSearchResult:a})})},d)}function ma(a){this._={portalWorkspace:a};this.id=a.id;this.isPublic=a.isPublic;this.name=a.name;this.date=a.date;this.maps=a.maps.map(function(a){return new fa(a)})}function fa(a){this._={portalMap:a};this.id=a.id;this.isPublic=a.isPublic;this.name=a.name;this.date=a.date}function Qa(a){var b=
a.get_bounds();a=b._bottomLeft_X+(b._upperRight_X-b._bottomLeft_X)/2;b=b._bottomLeft_Y+(b._upperRight_Y-b._bottomLeft_Y)/2;return new (g(Ra))(a,b)}function Sa(a){this._={c:a};var b=a.featureClass,c=a.geojson,d=g(I).readFeatureStub(c);a=a.actions||[];var e=d.attributes.filter(function(a){return a.Key===d.geometryFieldsNames[0]})[0];n(e)&&!g(Ra).isInstanceOfType(e.Value)&&(e.Value=Qa(e.Value));if(n(e)){this._.portalFeature=b.importFeature(d);this._.portalFeature.jsonRef=c.properties||{};this.over=new D({eventName:"pinOver"});
this.out=new D({eventName:"pinOut"});this.clicked=new D({eventName:"pinClicked"});for(var f in a)B.call(a,f)&&this[f].register(this._getHandler(f))}}function Oa(a){this._={config:a};if(a=a.portalApolloProcess)this.id=a.id,this.title=a.title,this.abs=a.abs,this.category=a.category,this.inputs=a.inputs||[],this.outputs=a.outputs||[]}function ea(a,b){var c=g(v);if(b)return c.findMapService(b).findLegendItemDefinition(a);var c=c.get_mapServices(),d,e;for(e in c)if(B.call(c,e)&&(d=c[e].findLegendItemDefinition(a)))return d;
return T}function qb(a,b){return function(c){c=new H({portalFeature:c,mapStateId:a});c=b(c);return Y(c)}}function rb(a,b){return function(c,d){var e=new H({portalFeature:c,mapStateId:a});return b(e,d)}}function ga(a,b,c){l.services.find(a,function(a){a=a.services&&a.services[0];if(!a)return k(q,c,{success:!1,msg:"no such a service"});var e=a._.ms;return e.get_supportsDataEditing()||e.get_config().supportsDataEditing?k(m,b,{success:!0,service:a,_service:e}):k(q,c,{success:!1,msg:"service does not support data editing"})})}
function sb(a,b){var c=a.mapService,d=a.legendItemDefinition,e=a.toInternalFeature,f=e(a.feature),h=a.columnNameMapping;g(p).notify(R,{actionName:"InsertFeature",legendItemDefinition:d,legendItemDefinitionKey:d.getKey(),wholeFeature:null,skipRasterLayers:!0,mapServiceId:c.get_id(),featureId:f&&f.get_id(),insertFeatureCallback:function(a){var d=a.get_attributes();Object.keys(d).forEach(function(a){"_KEY_"!==a&&f.set_attribute(h[a],d[a])});k(m,b,{feature:g(I).getFeature(f)})},insertFeatureScope:null},
null)}function tb(a,b){return function(){return k(m,b,{success:!0,features:a.features.map(function(b){return new H({portalFeature:b,mapStateId:a.mapStateId})}),featureClassId:a.featureClassId})}}function Ta(a,b,c,d){var e=b.promptForAttributes,f=b.geojson,f=f.features||[f],h=f.filter(function(a){return!!a.id}).length,w=u(b).get_id(),s=b.featureClassId,r=a.findLegendItemDefinition(s),m=b.beforeInsert||function(a,b){b(a)},p;if(0===h)p=a.insertFeatures;else if(h===f.length)p=a.updateFeatures;else{k(q,
d,{success:!1,msg:"id should be present either in all the features or not present at all"});return}a.ensureColumns([r],function(){var f=r.get_columns(),h=Array.prototype.reduce.call(f,function(a,b){a[b.aliasName]=b.name;return a},{});a.getFeatureDataset([r],function(f){var k=f.get_featureClasses()[s],q=k.get_fieldContainer().getKeyFields()[0],n=function(a){var b=a.id||l.utils.newGuid(q.get_type()),d=[];q&&d.push({Key:q.get_name(),Value:b});var c=a.properties||{},e;for(e in c)Object.hasOwnProperty.call(c,
e)&&d.push({Key:e,Value:c[e]});b={id:b,attributes:d};b=new (g(Ua))(k,b);typeof a.geometry!==E&&null!==a.geometry&&b.set_geometry(g(I).read(a.geometry));return b};ub({mapService:a,promptForAttributes:e,legendItemDefinition:r,columnNameMapping:h,featureClassId:s,toInternalFeature:n,geojson:b.geojson},function(b){vb({mapStateId:w,mapServiceId:a.get_id(),features:b,toInternalFeature:n,featureClassId:s,beforeInsert:m},function(b){var e=tb({features:b,featureClassId:s,mapStateId:w},c,d);p.call(a,s,b,e,
null)},d)},d)})})}function vb(a,b,c){var d=a.toInternalFeature,e=a.beforeInsert;e({features:a.features,featureClassId:a.featureClassId,mapServiceId:a.mapServiceId},function(a){a=a.features.map(d);k(m,b,a)},c)}function ub(a,b){var c=a.mapService,d=a.toInternalFeature,e=a.geojson,f=a.legendItemDefinition,h=a.columnNameMapping,e=e.features||[e],g,l=[],r=function(){0===g.length?k(m,b,l):sb({feature:g.shift(),toInternalFeature:d,legendItemDefinition:f,mapService:c,columnNameMapping:h},function(a){l.push(a.feature);
r()})};return a.promptForAttributes?(g=Array.prototype.slice.call(e),r()):k(m,b,e)}function wb(a,b){for(var c in b.properties)b.properties.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&(a.u[c]||a.x.push({aliasName:c,name:c,type:"System.String",isKey:!1}),a.u[c]=!0);return a}function xb(a){for(var b=new (g(Va)),c=0,d=a.length;c<d;c++){var e=a[c],f=g(I).readFeatureCollection(e.geojson,"geometry");f.id=e.featureClassId;f.name=e.featureClassName||f.id;f=b.createFeatureClass(f);e=[{name:"geometry",geometryType:4,
type:"Intergraph.WebSolutions.Core.WebClient.MapManager.Common.Geometry"}].concat(e.geojson.features.reduce(wb,{x:[],u:{}}).x);e=new (g(Wa))(e);f._fieldContainer=e}return b}function Xa(a){this._={column:a}}function yb(a){return new Xa(a)}var t="function",N="number",K="string",O="object",E="undefined",m="success",q="failure",cb="userAuthenticated",na="mapServiceInitialized",oa="mapServiceInitFailed",Ya="show",Za="hide",R="showFeatureInfo",$a="mapStateVariantChanged",pa="newLegendItemAdded",Z="mapLayerRendered",
S="selectedFeaturesChanged",G="$GP.internal",v="Intergraph.WebSolutions.Core.WebClient.Platform.MapServices.MapServiceManager",ca="Intergraph.WebSolutions.Core.WebClient.Platform.MapContent.MapStateManager",M="Intergraph.WebSolutions.Core.WebClient.Platform.Common.Util",ja="Intergraph.WebSolutions.Core.WebClient.Platform.User.UserManager",p="Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.ClientEventManager",A="Intergraph.WebSolutions.Core.WebClient.Platform.Common.CoordinateReferenceSystemManager",
C="Intergraph.WebSolutions.Core.WebClient.Platform.Web.WebRequestWrapper",da="Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.ClientLogWriter",wa="Intergraph.WebSolutions.Core.WebClient.Platform.MapContent.MapRange",Va="Intergraph.WebSolutions.Core.WebClient.Platform.Geodatabase.FeatureDataset",nb="Intergraph.WebSolutions.Core.WebClient.Platform.Geodatabase.FeatureClass",Ua="Intergraph.WebSolutions.Core.WebClient.Platform.Geodatabase.Feature",Ra="Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.Geometry.Point",
I="$geoJSON",gb="Intergraph.WebSolutions.Core.WebClient.Platform.Style.StyleBase",Wa="Intergraph.WebSolutions.Core.WebClient.Platform.Geodatabase.FieldContainer",pb="Intergraph.WebSolutions.Core.WebClient.Platform.Session.SessionManager",lb="Intergraph.WebSolutions.Core.WebClient.Platform.MapServices.QueryDefinitionItem",mb="http://www.opengis.net/ogc",ha={},l,ba,B=Object.prototype.hasOwnProperty;Ha.prototype={fitLayer:function(a){var b=this._.li.get_definition().get_mapService(),c=this._.li._definitionName||
b.get_definition().name,d=b.get_config().version;(ya(this._.mlc)||this._.li).fitLayer(g(A).getCurrent().get_id(),function(a){return"WMS"!==c?!1:g(A).qualifiesForSwapById(a,c,d)});k(m,a,{success:!0})},get_priority:function(){return(this._.mlc||this._.li).get_priority()},set_priority:function(a,b,c){var d=this._.config,e,f={mapStateId:u(d).get_id(),oldPriority:this.get_priority(),newPriority:a};if(this._.mlc){if(e="mapLayerPriorityChanged",0>a||a>u(d).get_mapLayerConfigs().length){k(q,c,{success:!1,
priority:a,msg:"Bad priority"});return}}else{e="priorityChanged";f.legendItem=this._.li;f.differLayers=!0;if(0>a||a>u(d).get_legend().get_flatLegend().length){k(q,c,{success:!1,priority:a,msg:"Bad priority"});return}u(d).setLegendItemPriority(this._.li,a)}g(p).notify(e,f,null);k(m,b,{success:!0,newPriority:a,legendItem:this})},remove:function(a){var b;(b=this._.mlc?U({items:[this._.li],mapStateId:this._.config.mapStateId,childrenGetter:"get_legendItems",predicate:L}):[this._.li])&&u(this._.config).removeLegendItems(b);
k(m,a,{success:!0})},get_name:function(){return this._.mlc?this._.mlc.get_name():this._.li.get_name()||this._.li.get_definition().get_name()},set_name:function(a){(this._.mlc||this._.li).set_name(a);g(p).notify("refreshMapLegendControl",{mapStateId:this._.config.mapStateId||"map"},null)},get_isVisible:function(){return!this._.mlc?this._.li.get_isVisible():0<U({items:[this._.li],mapStateId:this._.config.mapStateId,childrenGetter:"get_legendItems",predicate:function(a){return a.get_isVisible()}}).length},
set_isVisible:function(a){if(this._.mlc){for(var b=U({items:[this._.li],mapStateId:this._.config.mapStateId,childrenGetter:"get_legendItems",predicate:L}),c=0,d=b.length;c<d;c++)b[c].set_isVisible(a);g(p).notify("visibilityChanged",{legendItems:b,mapStateId:this._.config.mapStateId||"map"})}else this._.li.set_isVisible(a),g(p).notify("visibilityChanged",{legendItems:[this._.li],mapStateId:this._.config.mapStateId||"map"})},get_isLocatable:function(){return!this._.mlc?this._.li.get_isLocatable():!this._.mlc.get_isLocatabilityDisabled()},
set_isLocatable:function(a){if(this._.mlc)ya(this._.mlc)[a?"enableLocatability":"disableLocatability"]();else this._.li.set_isLocatable(a),g(p).notify("locatabilityChanged",{legendItems:[this._.li],mapStateId:this._.config.mapStateId||"map"})},get_opacity:function(){return!this._.mlc?null:this._.mlc.get_opacity()},set_opacity:function(a){this._.mlc&&(this._.mlc.set_opacity(a),g(p).notify("opacityChanged",{mapLayerConfigId:this._.mlc.get_id()},null))},get_pictogram:function(){return!this._.li?null:
this._.li.get_definition().get_pictogramDefinition()},set_pictogram:function(a){var b=this._.li;b&&a&&(b.get_definition().set_pictogramDefinition(a),g(p).notify("legendItemPictogramChanged",{legendItem:b,mapStateId:b.get_legend().get_mapState().get_id()},this))}};la.prototype={remove:function(a,b){var c=this._.ms.get_id();g(v).removeMapService(c,function(){var d=!g(v).findMapService(c);k(d?m:q,d?a:b,{success:d,msId:c})},this)},get_id:function(){return this._.ms.get_id()},get_name:function(){return this._.ms.get_name()},
get_definitionName:function(){return this._.ms._definitionName},get_url:function(){return this._.ms.get_config().url}};H.prototype={_getPortalFeatureObj:function(a,b){var c=this;jb({featureId:this._.proxy.featureId,featureClassId:this._.proxy.featureClassId},function(b){c._.f=b;a.call(c)},b)},get_geoJSON:function(a,b){if(!this._.f){n(a)||sa("Deprecated: get_geoJSON on a proxy feature object without a callback function");var c=this;this._getPortalFeatureObj(function(){c.get_geoJSON(a,b)},b);return{properties:"This get_geoJSON invocation is asynchronous. Use callback to get the data.",
geometry:{coordinates:[]}}}this._geoJSON||(this._geoJSON=g(I).getFeature(this._.f));k(m,a,this._geoJSON);return this._geoJSON},center:function(a,b){if(!this._.f){var c=this;return this._getPortalFeatureObj(function(){c.center(a,b)},b)}var d=this._.f.get_geometry(),d=Qa(d);return l.map.zoom({x:d.x,y:d.y},a)},get_id:function(){return this._.proxy.featureId||this._.f.getKey()[0]},get_featureClassId:function(){return this._.proxy.featureClassId||this._.f.get_featureClass().get_id()}};Ia.prototype={zoom:function(a,
b){typeof a===t&&(b=a,a={});var c=z({},a||{},{x:this.x,y:this.y});l.map.zoom(c,b)},get_geoJSON:function(a,b){if(!n(b)&&!this.point)return k(q,b,{message:"No data"}),null;var c={type:"Feature",geometry:{type:"Point",coordinates:[this.point.x,this.point.y]},properties:{name:this.name,score:this.score,bbox:this.bbox,id:this.id,mapServiceId:this.mapServiceId,mapServiceName:this.mapServiceName,index:this.index}};n(a)||k(m,a,c);return c}};Ja.prototype={_performAction:function(a){var b=g("Intergraph.WebSolutions.Core.WebClient.Controls.SearchResultActionManager"),
c=this.apollo;a=b.getAction(this._actionMapping[a]);return a.predicate({data:c})?(a.handler([{data:c,json:c}]),!0):!1},addToMap:function(a,b,c){a=a||{};var d=F();a=a.type||"wms";if(d){var d=this.apollo.nativeFootprint,e=this.apollo.footprint;d&&(d.envelope&&5===d.envelope.length)&&d.envelope.pop();e&&(e.envelope&&5===e.envelope.length)&&e.envelope.pop();this._performAction(a)?k(m,b,{success:!0,item:this}):k(q,c,{success:!1,message:"Item is not suitable for this action"})}else k(q,c,{success:!1,message:"Apollo Catalog not available"})},
_zoom:function(a,b,c,d){b=u(b);var e=!1,f=a.points[0],h=a.points[1];a.success&&(f.x===h.x&&f.y===h.y?b.centerToPoint(f.x,f.y):b.setMapRangeByPoints(f.x,f.y,h.x,h.y),e=!0);k(e?m:q,e?c:d,{success:e})},zoom:function(a,b,c){typeof a===t&&(c=b=a,a={});a=a||{};var d={},e=null,f=[],h=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,m=this,p=function(d){m._zoom(d,a,b,c)};if((!this.apollo||!this.apollo.footprint||!this.apollo.footprint.envelope)&&(!this.apollo.nativeFootprint||
!this.apollo.nativeFootprint.envelope))k(q,c,{success:!1,message:"No extents available. Zoom not possible."});else{this.apollo.nativeFootprint&&this.apollo.nativeFootprint.envelope?(d=this.apollo.nativeFootprint.data,e=this.apollo.nativeFootprint.srs):(d=this.apollo.footprint.data,e=this.apollo.footprint.srs);typeof d[0]===N?f=[d]:typeof d[0][0]===N&&(f=d);for(var n in f)if(f.hasOwnProperty(n))for(d=0;d<=f[n].length-2;d+=2)f[n][d]<h&&(h=f[n][d]),f[n][d+1]<g&&(g=f[n][d+1]),f[n][d]>s&&(s=f[n][d]),f[n][d+
1]>r&&(r=f[n][d+1]);l.crs.getCurrent()!==e?l.crs.transform({sourceCrsId:e,targetCrsId:l.crs.getCurrent(),points:[{x:h,y:g},{x:s,y:r}]},p):p({success:!0,points:[{x:h,y:g},{x:s,y:r}]})}},_ensureAction:function(a,b,c){var d=F();c=g("Intergraph.WebSolutions.Core.WebClient.Controls.SearchResultActionManager").getAction(c);d?c.predicate({data:this.apollo})?(c.handler([{json:this.apollo}]),k(m,a,{success:!0,item:this})):k(q,b,{success:!1,message:"Item is not suitable for this action"}):k(q,b,{success:!1,
message:"Apollo Catalog not available"})},showIndexMetadata:function(a,b){this._ensureAction(a,b,"index_metadata")},showISOMetadata:function(a,b){this._ensureAction(a,b,"iso_metadata")},downloadISOXML:function(a,b){this._ensureAction(a,b,"iso_metadata_download")},openIn:function(a,b,c){function d(a,b,d){a.setAttribute("type","hidden");a.setAttribute("name",b);a.setAttribute("value",d)}var e=F(),f=["com.erdas.rsp.babel.model.imagery.ImageReference","com.erdas.rsp.babel.model.imagery.Aggregate"],h=
document.createElement("form"),g=document.createElement("input"),s=document.createElement("input"),r=document.createElement("input");a.extension?0>f.indexOf(this.apollo._class)?k(q,c,{success:!1,message:"Item is not suitable for this action"}):e?(h.style.visibility="hidden",h.setAttribute("method","POST"),h.setAttribute("target","_blank"),h.setAttribute("action","ApolloSearch.WebClient.ashx?action=openIn"),d(g,"jsonData",l.utils.serialize([this.apollo.id])),d(s,"extension",a.extension),d(r,"mapServiceId",
e),h.appendChild(g),h.appendChild(s),h.appendChild(r),document.body.appendChild(h),h.submit(),document.body.removeChild(h),k(m,b,{success:!0,item:this})):k(q,c,{success:!1,message:"Apollo Catalog not available"}):k(q,c,{success:!1,message:"Extension not provided"})}};Ma.prototype={get_id:function(){return this._.portalAnalysis.get_id()},get_name:function(){return this._.portalAnalysis.get_name()},addToLegend:function(a,b,c){this.addToMap(a,b,c)},addToMap:function(a,b,c){typeof a===t&&(c=b=a={});a=
a||{};var d=this._.config,e=this._.portalAnalysis.get_id(),f=g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.AnalysisManager").findAnalysis(e),h=a.parentLayerName;a=a.parentLayerId;d=u(d);f=f.get_mapServiceId();l.legend.add({ids:[e],parentLayerName:h,parentLayerId:a,mapServiceId:f,mapStateId:d.get_id(),allowedTypes:[0,4]},b,c)},removeFromLegend:function(a){l.legend.find({id:this._.portalAnalysis.get_id()})[0].remove(a)},remove:function(a){g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.AnalysisManager").deleteAnalysis(this._.portalAnalysis.get_id());
k(m,a,{success:!0})},getData:function(a,b,c){typeof a===t&&(c=b=a,a={});a=a.force||!1;var d={},e=this._.portalAnalysis.get_id(),f=this._.portalAnalysis.get_mapServiceId(),f=g(v).findMapService(f),h=f.findLegendItemDefinition(e),k=l.crs.getCurrent(),s=g(A),k="WFS"===f.get_definition().name&&s.qualifiesForSwapById(k,"WFS");d[e]=a;f.getFeatureDataset([h],Ka({swapped:k},b,c),null,{force:d})},addToDataView:function(a,b,c){a=a||{};var d=this._.portalAnalysis.get_id(),e=this._.portalAnalysis.get_mapServiceId(),
f=g(v).findMapService(e).findLegendItemDefinition(d);a=La(a.dataWindowId);var h={};return!f?k(q,c,{success:!1,message:"No LegendItemDefinition for analysisId="+d}):a?(a.set_hidden(!1),a.selectAndAdd([f],h),k(m,b,{success:!0,analysisId:d,mapServiceId:e})):k(q,c,{success:!1,message:"No DataWindow object"})}};D.prototype={register:function(a){typeof a===t&&(a={handler:a});var b=a.handler,c=a.scope,d=typeof a.preventDefaults===E?!0:a.preventDefaults,e=typeof a.fallbackToDefaults===E?!0:a.fallbackToDefaults,
f=a.token||ua(),h=this._defaultHandlers;if(this._f[f]||typeof b!==t)return null;this._decorator&&([a.predicate,a.requestcompleted].some(function(a){return typeof a===t})&&e&&(a.fallback=function(a,b,d){for(var c=0,e=h.length;c<e;c++){var f=h[c].get_handler(),g=h[c].get_scope();typeof f===t&&f.call(g,a,b,d)}}),b=this._decorator(a));a=function(a,d,e){b.call(c,a,d,e)};this._f[f]=a;d&&this.suppressDefaults();g(p).register(this._eventName,a,null);return f},unregister:function(a){var b=typeof a===K,c=b?
a:a.token;a=b?null:a.scope;this._f[c]&&(g(p).unregister(this._eventName,this._f[c],a),this.restoreDefaults(),delete this._f[c])},suppressDefaults:function(){for(var a=0,b=this._defaultHandlers.length;a<b;a++){var c=this._defaultHandlers[a].get_handler(),d=this._defaultHandlers[a].get_scope();c&&g(p).unregister(this._eventName,c,d)}this._defaultsSuppressed=!0},restoreDefaults:function(){if(this._defaultsSuppressed)for(var a=0,b=this._defaultHandlers.length;a<b;a++){var c=this._defaultHandlers[a].get_handler(),
d=this._defaultHandlers[a].get_scope();c&&g(p).register(this._eventName,c,d)}},suppress:function(a){for(var b in this._f)B.call(this._f,b)&&g(p).unregister(this._eventName,this._f[b],null);a&&this.suppressDefaults()},restore:function(a){for(var b in this._f)B.call(this._f,b)&&g(p).register(this._eventName,this._f[b],null);a&&this.restoreDefaults()}};var qa=function(a){this.scope=a=a||{};this.funcs=[]};qa.prototype.push=function(a){this.funcs.push(a)};qa.prototype.flush=function(){for(var a;a=this.funcs.shift();)a.call(this.scope)};
var ab=function(a,b,c){this._descriptors=a;this._actionsFilter=b;this._actionsFilterScope=c};ab.prototype={getRowActionButtons:function(a,b){return this._descriptors.map(function(c){return typeof c.predicate===t&&!c.predicate.call(a)?[]:{text:c.text,id:c.id,style:c.style,handler:function(d,e){var f=a.legendItemDefinition.get_sourceLegendItemDefinition()||a.legendItemDefinition;c.handler.call(c.scope||b||l.ui.dataView,{featureId:e.id,data:e.data,mapServiceId:a.mapServiceId,featureClassId:f.get_id(),
id:a.legendItemDefinition.get_id(),clipboard:a.clipboard,fromClipboard:a.source.fromClipboard,canDelete:a.canDelete},d)}}}).filter(this._actionsFilter,this._actionsFilterScope)}};ba=J.$GP;l={_queue:new qa(J),_handlePageLoad:function(){if(!this.__pageLoadRegistered){var a=J.pageLoad;J.pageLoad=function(){typeof a===t&&a();l.__pageLoaded||(l._queue.flush(),l.__pageLoaded=!0,J.pageLoad=a)};this.__pageLoadRegistered=!0}},ready:function(a,b){typeof a===t&&!n(b)&&(b=a,a="v1.0",sa('[DEPRECATED] you should call "ready" function using version as first parameter. Using default version: v1.0'));
if(!a.match(/^v1\./i))throw Error("API in version "+a+" doesn't exist");this._handlePageLoad();this._queue.push(b);l.__pageLoaded&&this._queue.flush()},version:"16.00.0104",noConflict:function(){J.$GP=ba;return this},searchDefaults:{ep:"all",action:"search",handler:"SearchHandler",mode:1,profile:"full",classType:"com.erdas.rsp.babel.model.CatalogItem"},search:function(a,b,c){"apollo"===a.searchType?l.search.apollo(a,b,c):l.search.names(a,b,c)}};l.search.apollo=function(a,b,c){a=z({},a,l.searchDefaults);
var d=F();d?(d={mapServiceId:d,action:"search",profile:a.profile,keywords:a.keywords,classType:a.classType,bbox:a.bbox,geometryType:a.geometryType,orderBy:a.orderBy,cswQuery:a.cswQuery,addToMap:a.addToMapEnabled,downloadable:a.downloadable,wmts:a.wmtsEnabled,ecwp:a.ecwpEnabled,jpip:a.jpipEnabled,dateType:a.dateType,dateStart:a.startDate,dateEnd:a.endDate,currentCrs:a.crsId||l.crs.getCurrent(),nameQualifier:a.nameQualifier,queryables:a.queryables?l.utils.serialize(a.queryables):null,template:a.template?
l.utils.serialize(a.template):null,title:a.title,addKeywordsToTitle:a.addKeywordsToTitle},n(a.limit)&&n(a.start)&&(d.limit=a.limit,d.start=a.start),b=g(C).create({name:"ApolloSearch",body:d,callback:Pa(b,c,"results")}),a.addToSearchPanel?l.ui.searchResultPanel.displayResult(d):b.invoke()):k(q,c,{success:!1,message:"Apollo Catalog not available"})};l.search.names=function(a,b,c){a=z({},a,l.searchDefaults);g(C).create({name:a.handler,query:{},body:{action:a.action,ep:a.ep,query:a.query,allMapServiceIds:Object.keys(g(v).get_mapServices())[0]},
includeCRS:!0,callback:Q(b,c,function(a){return a.values.map(function(a){return new Ia({portalSearchResult:a})})})}).invoke()};J.$GP=l;for(var ra in ba)B.call(ba,ra)&&(J.$GP[ra]=ba[ra]);l._getMapState=u;var bb=typeof JSON===O;l.utils={serialize:bb?JSON.stringify:Sys.Serialization.JavaScriptSerializer.serialize,deserialize:bb?JSON.parse:Sys.Serialization.JavaScriptSerializer.deserialize,dump:function(a){var b={},c;for(c in a)c.match(/^get_/)&&typeof a[c]===t&&(b[c.replace(/^get_/,"")]=a[c]());return b},
sdump:function(a){return this.serialize(this.dump(a))},getInScreenCrs:Ba,getInMapCrs:function(a){var b=u(a).get_mapControl();return{x:b.get_xInMapResolution(a.x),y:b.get_yInMapResolution(a.y)}},newGuid:function(a){return g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Edit.Support").newGuid(a)},toFeatureCollection:function(a,b,c){Ga({featureIds:a.features.map(function(a){return a.get_id()}),featureClassId:a.featureClassId||a.features[0].get_featureClassId()},function(a){a={type:"FeatureCollection",
features:a.map(function(a){return g(I).getFeature(a)})};k(m,b,a)},c)}};l.services={add:function(a,b,c){function d(a,f,h){h.get_id()===w&&(a===na&&(g(da).writeInfo("map service initialized"),k(m,b,{success:!0,msId:w,mapServiceId:w,message:"Map service successfully registered"})),a===oa&&(g(da).writeInfo("map service initialization failed"),k(q,c,{success:!1,msId:w,mapServiceId:w,message:"Map service initialization failed"})),g(p).unregister(na,d,e),g(p).unregister(oa,d,e))}var e=this,f=a.definitionName,
h=a.url,w=g(v).findMapServiceByUrl(h);if(typeof w!==E)return k(m,b,{success:!0,msId:w,mapServiceId:w,message:"Map service already registered"}),this;w=a.id||l.utils.newGuid();a=Aa(a);g(p).register(na,d,this);g(p).register(oa,d,this);g(v).registerMapService({id:w,config:a,definition:{name:f}});g(v).findMapService(w).initialize();return this},find:function(a,b,c){var d=[];if(a.mapServiceId||a.url||a.definitionName){var e=g(v).findMapService(a.mapServiceId||g(v).findMapServiceByUrl(a.url))||g(v).findMapServicesByDefinitionName(a.definitionName);
Array.isArray(e)&&(e=e.filter(function(b){return b.get_name()===a.name})[0]);e&&d.push(new la({portalMapService:e}))}if(a.predicate)for(var e=g(v).get_mapServices()||[],f=0,h=e.length;f<h;f++)a.predicate(e[f])||d.push(new la({portalMapService:e[f]}));!a.successOnEmpty&&1>d.length?k(q,c,{success:!1}):k(m,b,{success:!0,services:d,ids:d.map(function(a){return a.get_id()}),service:1===d.length?d[0]:T,mapServiceId:1===d.length?d[0].get_id():T});return a.async?this:d}};l.legend={_displayLayers:function(a,
b){function c(a,e){function f(a,c,e){h===e.get_config().get_id()&&(k(m,b,{success:!0,ids:d}),g(p).unregister(Z,f,l))}if(!(e.mapLayerConfigs&&1!==e.mapLayerConfigs.length)){var h=e.mapLayerConfigs[0].get_id();g(p).unregister(pa,c,l);g(p).register(Z,f,l)}}for(var d=za({transformer:function(a){return a.get_id()},names:a.names,ids:a.ids,mapServiceId:a.mapServiceId,allowedTypes:a.allowedTypes}),e=u(a).get_legend().get_flatLegend().length,f={},h=d.length-1;0<=h;h--)f[d[h]]=e++;e=null;"function"===typeof a.userStyleCallback&&
(e=[[{userStyleCallback:function(b){b=new H({portalFeature:b,mapStateId:u(a).get_id()});b=a.userStyleCallback(b);return Y(b)}}]]);var l=this;a.successAfterRender&&g(p).register(pa,c,l);u(a).addLegendItemByDefinitionId([a.mapServiceId],[d],a.name?[a.name]:null,null,e,[f]);a.successAfterRender||k(m,b,{success:!0,ids:d})},_addToMapLayer:function(a,b,c){var d=a.mapServiceId,e=a.ids,f=a.names,h=a.parentLayerName,l=a.parentLayerId,s=u(a),r=g(v).findMapService(d);if(!s)return k(q,c,{message:"Cannot find mapState"});
if(!r)return k(q,c,{message:"Cannot find mapService"});r=r.get_definition();h=eb({mapStateId:s.get_id(),mapLayerName:h,mapLayerId:l,mapServiceId:d});if(!h)return k(q,c,{message:"Cannot find parent map layer"});var l=h.get_config(),p=l.get_firstLegendItemPriority(),p=!!s.get_legend().get_flatLegend()[p];if(r.onlyOneItemPerLayer&&!p)return k(q,c,{message:"Cannot add layer"});a=za({transformer:function(a){return a},names:f,ids:e,mapServiceId:d,allowedTypes:a.allowedTypes});if(!a||!a.length)return k(q,
c,{message:"No legend items found"});s.addToMapLayer(a,h);k(m,b,{ids:e,mapStateId:s.get_id(),parentMapLayerId:l.get_id()})},_addDynamic:function(a,b,c){var d=a.mapServiceId,d=g(v).findMapService(d),e=d.get_definition().name;a=a.ids;if("WMS"!==e)return k(q,c,{message:"Dynamic layers are supported only for WMS"});var f={};d.get_legendItemDefinitions().forEach(function(a){f[a.get_id()]=!0});var h=a.filter(function(a){return!f[a]});d.createOuterLegendItemDefinitions(h,{handler:function(){return k(m,b,
{success:!0,dynamicLayerIds:h})}})},add:function(a,b,c){var d=a.mapServiceId,e=a.url,f=a.definitionName,h=this;!d&&a.url&&(d=g(v).findMapServiceByUrl(e));var w=g(v).findMapService(d),m=$(a.parentLayerId,a.parentLayerName,a.topmostParent)?this._addToMapLayer:this._displayLayers;if(a.dynamic)var r=m,m=function(a,b,d){h._addDynamic(a,function(){r(a,b,d)},d)};w?(a.mapServiceId=d,m(a,b)):e&&f?(d=z({},a,{},function(a,b){return typeof a[b]!==t}),l.services.add(d,function(d){a.mapServiceId=d.msId;m(a,b,c)})):
k(q,c,{success:!1})},find:function(a,b,c){typeof a===t&&(b=a,a={});a=a||{};var d=[],e;e=a.predicate?a.predicate:a.leaf||!1===a.root?function(a){return!!a._parent}:a.root||!1===a.leaf?function(a){return!a._parent}:a.id?function(b){return b.get_definition().get_id()===a.id}:a.legendItemId?function(b){return b.get_id()===a.legendItemId}:a.name?function(b){return b.get_definition().get_name()===a.name}:L;var f=u(a).get_legend();e=U({childrenGetter:"get_legendItems",items:f.get_legendItems(),predicate:e});
for(var f=0,h=e.length;f<h;f++)d.push(new Ha({portalLegendItem:e[f],mapStateId:a.mapStateId}));!a.successOnEmpty&&1>d.length?k(q,c,{success:!1}):k(m,b,{success:!0,legendItems:d})}};ma.prototype={display:function(a,b){typeof a===t&&(b=a,a={});a=a||{};var c=this,d=u(a).get_id();l.user._getMapStorageManager().displayWorkspace(this.id,d,function(){k(m,b,{workspace:c})},c)},remove:function(a){l.user._getMapStorageManager().removeWorkspace(this.id,function(){g(p).notify("userMapListChanged",{},this);k(m,
a,{success:!0})})},set_name:function(a,b){l.user._getMapStorageManager().setWorkspaceName(this.id,a,function(){this.name=a;g(p).notify("userMapListChanged",{},this);k(m,b,{success:!0,map:this,workspace:this})})},set_isPublic:function(a,b){l.user._getMapStorageManager().setWorkspacePublic(this.id,a,function(){this.isPublic=a;g(p).notify("userMapListChanged",{},this);k(m,b,{success:!0,map:this,workspace:this})})}};fa.prototype={display:function(a,b){typeof a===t&&(b=a,a={});a=a||{};var c=this,d=u(a).get_id();
l.user._getMapStorageManager().displayMap(this.id,d,function(){k(m,b,{map:c})},c)},remove:function(a){l.user._getMapStorageManager().removeMap(this.id,function(){g(p).notify("userMapListChanged",{},this);k(m,a,{success:!0})})},set_name:function(a,b){l.user._getMapStorageManager().setMapName(this.id,a,function(){this.name=a;g(p).notify("userMapListChanged",{},this);k(m,b,{success:!0,map:this})})},set_isPublic:function(a,b){l.user._getMapStorageManager().setMapPublic(this.id,a,function(){this.isPublic=
a;g(p).notify("userMapListChanged",{},this);k(m,b,{success:!0,map:this})})}};l.user={_getMapStorageManager:function(){return g("Intergraph.WebSolutions.Core.WebClient.Platform").MapStorage.MapStorageManager},login:function(a,b){va("logIn",a.username,a.password,b)},getCurrent:function(){return g(ja).getActiveUser()},logout:function(a){va("logOut",a)},workspaces:{find:function(a,b){typeof a===t&&(b=a,a={});a=a||{};var c=ia({key:"id",value:a.id},{key:"name",value:a.name}),d=a.predicate||(n(a.id)||n(a.name)?
c:L);l.user._getMapStorageManager().getContent(function(a){var c=[];a=a.workspaces||[];for(var h=0,g=a.length;h<g;h++)d(a[h])&&c.push(new ma(a[h]));k(m,b,{workspaces:c})})},add:function(a,b){var c=z({},a,{mapStateId:u(a).get_id(),handler:function(d){g(p).notify("userMapListChanged",{},this);d=new ma(d.workspace);n(a.isPublic)?d.set_isPublic(a.isPublic,function(a){k(m,b,a.workspace)}):k(m,b,d)},scope:this});l.user._getMapStorageManager().saveWorkspace(c)},remove:function(a,b,c){this.find(a,function(a){var e=
a.workspaces;if(!Array.isArray(e)||0===e.length)k(q,c,{message:"No workspaces found"});else{var f=e.map(function(a){return a.id}),h=function(){var a=e.shift();a?a.remove(h):k(m,b,{ids:f})};h()}},c)},current:{clear:function(a,b){a=a||{};var c=u(a);c.clearMap();g(v).removeAllMapServices(function(){g(p).notify("mapStateVariantListChanged",{mapStateId:c.get_id()},this);k(m,b,{success:!0})})}}},maps:{find:function(a,b){typeof a===t&&(b=a,a={});a=a||{};var c=ia({key:"id",value:a.id},{key:"name",value:a.name}),
d=a.predicate||(n(a.id)||n(a.name)?c:L);l.user._getMapStorageManager().getContent(function(a){var c=[];a=a.maps||[];for(var h=0,g=a.length;h<g;h++)d(a[h])&&c.push(new fa(a[h]));k(m,b,{maps:c})})},add:function(a,b){l.user._getMapStorageManager().saveMap("map",a.workspace||null,a.name,function(c){c&&(c.map&&c.map.id)&&l.user._getMapStorageManager().setMapName(c.map.id,a.name);c=new fa(c.map);n(a.isPublic)?c.set_isPublic(a.isPublic,function(a){k(m,b,a.map)}):k(m,b,c);g(p).notify("userMapListChanged",
{},this)},this)},remove:function(a,b,c){this.find(a,function(a){var e=a.maps;if(!Array.isArray(e)||0===e.length)k(q,c,{message:"No maps found"});else{var f=e.map(function(a){return a.id}),h=function(){var a=e.shift();a?a.remove(h):k(m,b,{ids:f})};h()}},c)}}};l.events={mapMoved:new D({eventName:"mapRangeChanged"}),legendItemAdded:new D({eventName:pa,decorator:function(a){var b=a.handler;return function(a,d){d.mapLayerConfigs.forEach(function(a){a.forEachLegendItem(function(a){l.legend.find({legendItemId:a.get_id()},
function(a){V("legendItemAdded",b,a.legendItems[0])})},this)})}}}),legendItemRemoved:new D({eventName:"legendItemRemoved",decorator:function(a){var b=a.handler;return function(a,d){d.removedLegendItemsDefinitionId.forEach(function(a){V("legendItemRemoved",b,a)})}}}),legendItemLoadingStarted:new D({eventName:"mapLayerRendering",decorator:function(a){var b=a.handler;return function(a,d){V("legendItemLoadingStarted",b,{mapLayerConfigId:d.mapLayerConfigId})}}}),legendItemLoadingFinished:new D({eventName:Z,
decorator:function(a){var b=a.handler;return function(a,d){V("legendItemLoadingFinished",b,{mapLayerConfigId:d.mapLayerConfigId})}}}),legendItemVisibilityChanged:new D({eventName:"visibilityChanged",decorator:function(a){var b=a.handler;return function(a,d){d.legendItems.map(function(a){return a.get_id()}).forEach(function(a){l.legend.find({legendItemId:a},function(a){V("legendItemVisibilityChanged",b,a.legendItems[0])})})}}}),selectedFeaturesChanged:new D({eventName:S,decorator:function(a){var b=
a.handler;return function(a,d){var e={},f=g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.SelectedFeaturesManager").getAllSelectedFeatures();d&&d.legendItemDefinitions&&(e.featureClassIds=d.legendItemDefinitions.map(function(a){return a.get_id()}));e.featureStubs=ob(f);V("selectedFeaturesChanged",b,e)}}}),featureInfoRequested:new D({eventName:R,decorator:Fa,defaultHandlers:[{get_handler:function(){return g(G).featureInfoController._checkSessionBeforeFeatureInfo},get_scope:function(){return g(G).featureInfoController}}]}),
featureInfoForAllLayersRequested:new D({eventName:"showFeatureInfoForAllLayers",decorator:function(a){var b=a.handler,c=a.transformargs,d=a.requestcompleted,e=a.httphandler,f=a.predicate,h=a.fallback,k=a.geometryFieldNames&&a.geometryFieldNames.map(function(a){return a.toLowerCase()});a=g(G).featureInfoController;g(p).unregister("showFeatureInfoLoading",a._checkSessionBeforeFeatureInfo,a);g(p).register("featureInfoForAllLayersFinished",function(a,c){if(typeof d===t){var e={result:c};d(c)?b(c,e):h(a,
e)}else b(c)});return function(a,b,d){if(b.legendItemDefinition){var l=b.legendItemDefinition.get_sourceLegendItemDefinition()||b.legendItemDefinition;b.skipRasterLayers=l.get_mapService().get_supportsDataEditing()||"undefined"!==typeof b.featureId&&"undefined"===typeof x&&"undefined"===typeof y;b.mapServiceId=l.get_mapService().get_id();b.legendItemDefinitionKey=l.getKey()}b.requestEndpoint=e;b.wholeFeature=null;typeof f===t&&!f(b)?typeof h===t&&h(a,b,d):(typeof c===t&&(b=c(b)),b.geometryFieldsToSerialize=
k,g(G).featureInfoController._checkSessionBeforeFeatureInfo(a,b,d))}},defaultHandlers:[{get_handler:function(){return g(G).featureInfoController._checkSessionBeforeFeatureInfo},get_scope:function(){return g(G).featureInfoController}}]})};l.map={getCurrentVariant:function(a,b){typeof a===t&&!n(b)&&(b=a);if(!n(a)||typeof a!==O)a={};var c=u(a).get_currentVariantId();k(m,b,{variantId:c})},setCurrentVariant:function(a,b,c){function d(a,c){k(m,b,{variantId:c.mapStateVariantId,mapStateId:c.mapStateId});
g(p).unregister($a,d,null)}a=a||{};var e=a.variantId,f=!a.keepMapRange;a=u(a);if(!n(e))return k(q,c,{message:"No such a variant"});g(p).register($a,d,null);a.setVariant(e,!0,f)},getVariants:function(a,b){typeof a===t&&!n(b)&&(b=a);if(!n(a)||typeof a!==O)a={};var c=u(a).get_variants().filter(function(a){return"__default_"!==a.id}).map(function(a){return a.id});k(m,b,{variantIds:c})},getMode:function(a,b){typeof a===t&&!n(b)&&(b=a);var c=u(a).get_mapControl().get_definitionName();return k(m,b,{id:c})},
setMode:function(a,b,c){function d(c,f){e.get_id()===f.mapStateId&&(k(m,b,{success:!0,id:a.id}),h.unregister("mapControlChanged",d,null))}a=a||{};var e=u(a),f=e.get_mapControl().get_definitionName(),h=g(p);if(0>["WCMyvrMapControl","WCMapControl"].indexOf(a.id))return k(q,c,{success:!1});if(a.id===f)return k(m,b,{success:!0});h.register("mapControlChanged",d,null);h.notify("switch3d2d",{id:a.id});return null},transform:function(a,b,c){a=a||{};var d=u(a),e=d.get_mapRange().serialize(),f,h,w,s=a.scaleDenominator,
r=a.options;$(a.offsetX,a.offsetY)&&(f=new (g("Intergraph.WebSolutions.Core.WebClient.Platform.Common.Size"))(n(a.offsetX)?a.offsetX:0,n(a.offsetY)?a.offsetY:0));ta(a.minX,a.minY,a.maxX,a.maxY)&&(w=new (g(wa))([a.minX,a.minY,a.maxX,a.maxY]));$(a.x,a.y)&&(h={x:n(a.x)?a.x:(e[2]-e[0])/2,y:n(a.y)?a.y:(e[3]-e[1])/2});if($(s,w,h,f,a.zoomFactor)){n(s)&&(c=d.get_minScaleDenominator(),e=d.get_maxScaleDenominator(),c&&(s=Math.max(s,c)),e&&(s=Math.min(s,e)));n(w)&&d.set_mapRange(w,r);n(h)&&d.centerToPoint(h.x,
h.y);if(n(f))if(a.duration)var t=a.duration/100,v=f.width/t,X=f.height/t,z=setInterval(function(){--t?l.map.transform({offsetX:v,offsetY:X}):clearTimeout(z)},100);else d.get_mapRange().movePx(f,d.get_mapControl().get_mapSize()),g(p).notify("mapRangeChanged",{mapStateId:d.get_id()},this);n(s)&&(d.get_mapControl().set_scaleDenominator(s,r),g(p).notify("scaleChanged",{scaleDenominator:s,mapStateId:d.get_id()},this));n(a.zoomFactor)&&d.zoom(a.zoomFactor);k(m,b,{success:!0})}else k(q,c,{success:!1,message:"Invalid parameters"})},
pan:function(a,b,c){var d=typeof a===O?a:{};Array.isArray(a)?(d.offsetX=a[0],d.offsetY=a[1]):ta(d.x,d.x)&&(delete a.x,delete a.y,d.offsetX=a.x,d.offsetY=a.y);this.transform(d,b,c)},zoom:function(a,b,c){var d=typeof a===O?a:{};typeof a===N?d.zoomFactor=a:Array.isArray(a)?(d.minX=a[0],d.minY=a[1],d.maxX=a[2],d.maxY=a[3]):n(a)&&Array.isArray(a.bbox)&&(d.minX=a.bbox[0],d.minY=a.bbox[1],d.maxX=a.bbox[2],d.maxY=a.bbox[3]);if(!$(d.zoomFactor,d.bbox,d.x,d.scaleDenominator)){a=u(a);var e=function(a,d){k(m,
b,{mapStateId:d.mapStateId});g(p).unregister("mapRangeChanged",e,null)};g(p).register("mapRangeChanged",e,null);g(p).notify("zoomRect",{mapStateId:a.get_id()},null)}this.transform(d,b,c)},info:function(a,b){a=a||{};var c=u(a),d=c.get_mapControl(),e=c.get_mapRange(),c=e.getBottomLeft(),f=e.getUpperRight(),e=e.getCenter(),d={bbox:[c.x,c.y,f.x,f.y],center:{x:e.x,y:e.y},scaleDenominator:d.get_scaleDenominator(),crs:l.crs.getCurrent()};k(m,b,d);return d},featureInfo:function(a,b,c){a=a||{};var d=u(a),
e=d.get_mapControl(),f=a.screenX,h=a.screenY,w,s=this,r=g(G).featureInfoController;if((typeof f===E||typeof h===E)&&typeof a.x!==E&&typeof a.y!==E)h=Ba(a),f=h.x,h=h.y;if(a.preventDefaults){for(var n=g(p)._events.showFeatureInfo,t=0,X=n.length;t<X;t++)if(n[t].scope&&n[t].scope===r){w=n[t];g(p).unregister(R,n[t].handler,n[t].scope);break}g(G).featureInfoHelper.preventDefaults=!0}var v=Fa({handler:function(a){var d;try{a.error?d=!0:k(m,b,{success:!0,result:a})}catch(e){d=!0}d&&k(q,c,{success:!1,result:a});
g(p).unregister("featureInfoForAllLayersFinished",v,s);g(p).unregister(R,v,s);w&&g(p).register(R,w.handler,w.scope)}}),z=function(a,d){var e;try{d.error?e=!0:k(m,b,{success:!0,result:d})}catch(f){e=!0}e&&k(q,c,{success:!1,result:d});g(p).unregister("featureInfoForAllLayersFinished",z,s)};a.queryAllLayers||a.queryAllVectorLayers?g(p).register("featureInfoForAllLayersFinished",z,s):g(p).register(R,v,s);a.queryAllVectorLayers&&(g(G).featureInfoHelper.onlyVectorLayers=!0);a.featureId&&a.legendItemDefinitionId&&
(a.mapServiceId||a.url)?(d=(d=l.services.find({url:a.url,mapServiceId:a.mapServiceId})[0])&&d._.ms.findLegendItemDefinition(a.legendItemDefinitionId))?g(p).notify(R,{x:f,y:h,featureId:a.featureId,legendItemDefinition:d},s):k(q,c,{success:!1,msg:"Legend item definition not found"}):typeof f!==E&&typeof h!==E?a.queryAllLayers||a.queryAllVectorLayers?g(G).featureInfoHelper.notifyFeatureInfoForAllLayers({screenX:f,screenY:h,onlyVectorLayers:a.queryAllVectorLayers}):e.featureInfo({x:f,y:h}):g(p).notify("featureInfo",
{mapStateId:d.get_id()},s)},refresh:function(a,b,c){function d(a,c){c.mapStateId===f.get_id()&&(l++,l===h&&(e.unregister(Z,d,s),k(m,b,{success:!0,numberOfRendered:l})))}var e=g(p),f=u(a),h=f.get_mapControl().get_mapLayers().length,l=0,s=this;try{e.register(Z,d,s),f.get_mapControl()._resetLayers()}catch(r){e.unregister(Z,d,s),k(q,c,{success:!1})}}};l.map.center=l.map.transform;l.map.draw=function(a,b,c){this.defaultLayerName="Bubek";return!a.coordinates&&"Point"===a.type?l.map.draw.point.call(l.map.draw,
a,b,c):!a.coordinates&&"LineString"===a.type?l.map.draw.path.call(l.map.draw,a,b,c):!a.coordinates&&"Polygon"===a.type?l.map.draw.polygon.call(l.map.draw,a,b,c):a.type?l.map.draw.geojson.call(l.map.draw,a,b,c):this};l.map.draw._perform=function(a,b){var c=g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.Redlinig"),d=u(b).get_mapControl(),d=c.getNamedRedliningLayer(b.layerName||this.defaultLayerName,d,b.showMeasure||!1);a.call(this,c,d)};l.map.draw._afterPerform=function(a,b){return function(c){var d=
{success:!0},e=Array.isArray(c);d.features=(!e?[c]:c).map(function(b){return new H({portalFeature:b,mapStateId:a.mapStateId})});e||(d.feature=d.features[0]);k(m,b,d)}};l.map.draw.geojson=function(a,b,c){a=a||{};a.defaultStyleName=a.defaultStyleName||"redlining";var d=Y(a);"FeatureCollection"===a.type?this._perform(function(e,f){e.drawFeatureClassStub(f,this._afterPerform(a,b,c),this,d,g(I).read(a))},a,b,c):this._perform(function(e,f){e.drawFeatureStub(f,this._afterPerform(a,b,c),this,d,g(I).readFeatureStub(a))},
a,b,c);return this};l.map.draw.point=function(a,b,c){a=a||{};a.defaultStyleName=a.defaultStyleName||"redlining";for(var d=a.x&&a.y?{x:a.x,y:a.y}:T,d=a.points||[d],e=Y(a),f=function(d){return function(f,h){f.drawPoint(h,this._afterPerform(a,b,c),this,e,d)}},h=0,g=d.length;h<g;h++)this._perform(f(d[h]),a,b,c);return this};l.map.draw.path=function(a,b,c){a=a||{};a.defaultStyleName=a.defaultStyleName||"redlining";var d=this,e=Y(a);d._perform(function(f,h){f.drawPolyline(h,d._afterPerform(a,b,c),d,e,a.points,
a.geometryType)},a,b,c);return d};l.map.draw.polygon=function(a,b,c){a=a||{};a.defaultStyleName=a.defaultStyleName||"redlining";var d=Y(a);this._perform(function(e,f){e.drawPolygon(f,this._afterPerform(a,b,c),this,d,a.points,a.geometryType,void 0)},a,b,c);return this};l.map.draw.rectangle=function(a,b,c){return this.polygon(z({},a,{geometryType:2}),b,c)};l.map.draw.circle=function(a,b,c){return this.polygon(z({},a,{geometryType:10}),b,c)};l.map.draw.arc=function(a,b,c){return this.polygon(z({},a,
{geometryType:9}),b,c)};l.map.draw.clear=function(a,b){a=a||{};var c=g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.Redlinig"),d=u(a).get_mapControl(),d=c.getNamedRedliningLayer(a.layerName||this.defaultLayerName,d,a.showMeasure||!1);c.eraseFeatures(d);k(m,b,{success:!0})};l.map.draw.setVisibility=function(a,b){a=a||{};var c=g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.Redlinig"),d=u(a).get_mapControl();c.getNamedRedliningLayer(a.layerName||this.defaultLayerName,
d,a.showMeasure||!1).set_visibility(!!a.visibility);k(m,b,{success:!0})};Sa.prototype={_getHandler:function(a){var b=this,c=b._.c;return function(d,e){e&&e.feature===b._.portalFeature&&c.actions[a].call(b,e.DOMElement)}},remove:function(){this.over.suppress();this.out.suppress();this.clicked.suppress();var a=this._.c,b=a.featureClass.get_id(),c=a.pinLayer._featureClassCollection[b].get_features()||{},d;for(d in c)if(B.call(c,d)&&c[d]===this._.portalFeature){delete c[d];break}a.pinLayer.refresh(b)},
zoom:function(a,b){var c=this._.portalFeature.get_geometry(),c=z({},a,{x:c.x,y:c.y});l.map.zoom(c,b)},getFeature:function(){return new H({portalFeature:this._.portalFeature})}};l.map.pin={defaults:{featureClassName:"pins",featureClassId:"pins",geometryFieldName:"geometry",className:"wc_map_layer_pin"},_ensureFeatureClass:function(a,b){a=z({},a,this.defaults);this._featureClasses=this._featureClasses||{};this._featureClasses[b]=this._featureClasses[b]||{};this._featureDatasets=this._featureDatasets||
{};this._featureDatasets[b]=this._featureDatasets[b]||new (g(Va));var c=a.featureClassId,d=this._featureDatasets[b];return this._featureClasses[b][c]=this._featureClasses[b][c]||d.createFeatureClass({id:c,name:a.featureClassName,geometryFieldName:a.geometryFieldName,fields:[{name:a.geometryFieldName,geometryType:1}]})},_ensurePinLayer:function(a){var b=u(a).get_mapControl(),c=b.get_definitionName();this._pinLayers||(this._pinLayers={});var d=this._ensureFeatureClass(a,c);(a=this._pinLayers[c])||(a=
this._pinLayers[c]=b.getCommonPinLayer());a.addFeatureClass(d);a.set_visibility(!0);return a},add:function(a,b){a=z({},a,this.defaults);var c=u(a).get_mapControl().get_definitionName(),d=this._ensurePinLayer(a),e=this._featureClasses[c][a.featureClassId],f=a.geojson,h=a.actions,c=a.className;!f&&(typeof a.x===N&&typeof a.y===N)&&(f={type:"Point",coordinates:[a.x,a.y]});if("FeatureCollection"===f.type){d=f.features||[];c=d.length-1;e=0;for(f=d.length;e<f;e++)h=z({},a),h.geojson=d[e],h.skipfire=!0,
e===c&&(h.skipfire=!1,h._collection=!0),l.map.pin.add(h,b)}else e=new Sa({featureClass:e,geojson:f,actions:h,mapStateId:a.mapStateId,pinLayer:this._pinLayer}),a.skipfire||(d._pinCls=c,d.refresh(a.featureClassId),k(m,b,{success:!0,pin:e}))},clear:function(a,b){a=z({},a||{},this.defaults);var c=u(a).get_mapControl().get_definitionName(),d=a.featureClassId,e=this._ensurePinLayer(a),c=this._featureClasses[c][d];n(d)&&e.removeFeatureClass?e.removeFeatureClass(d):e.removeAllFeatureClasses&&e.removeAllFeatureClasses();
c.clearFeatures();e.refresh(d);k(m,b,{success:!0})},setVisibility:function(a,b){a=z({},a||{},this.defaults);this._ensurePinLayer(a).set_visibility(a.visibility);k(m,b,{success:!0})}};l.crs={_find:function(a,b){var c=[];if(Array.isArray(b))for(var d=0,e=b.length;d<e;d++)c=c.concat(this._find(a,b[d]));else Array.isArray(b.children)?c=c.concat(this._find(a,b.children)):b&&null===b.children&&a(b)&&c.push(b);return c},_findAll:function(a,b){var c=this;g(C).create({name:"CrsTree",query:{action:"getTree"},
includeCRS:!1,callback:function(d){d=d.get_object();d=c._find(a,d);k(m,b,{success:!0,crs:d})},scope:this}).invoke()},find:function(a,b){var c,d,e;typeof a===K?c=a:typeof a===t?e=a:a instanceof RegExp?d=a:a.code?c=a.code:a.regex?d=a.regex:a.predicate&&(e=a.predicate);d?e=function(a){return a.value.match(d)||a.text.match(d)}:c&&(e=function(a){return a.value===c});e||(e=L);this._findAll(e,b)},setCurrent:function(a,b,c){var d=g(ca).get_mapStates(),e={},f;for(f in d)B.call(d,f)&&(e[f]=!0);var d={correctOnlyHeightAspectRatio:e},
h;typeof a===K?h=a:a&&(h=a.code);h===this.getCurrent()&&k(m,b,{success:!0,crsId:h});h||k(q,c,{success:!1,crsId:h});g(A).setCurrent(h,d,function(a){a?(g(p).notify("cancelMapOperation",{},this),g(p).notify("crsChanged",null,this),k(m,b,{success:!0,crsId:h})):k(q,c,{success:!1,crsId:h})},this)},getCurrent:function(){return g(A).getCurrent().get_id()},register:function(a,b){var c=this,d;typeof a===K?d=a:a&&a.code&&(d=a.code);d&&d in this.getRegistered()?k(m,b,{success:!0,msg:"Already registered",crsIds:[d]}):
this.find(a,function(a){if(a.success){var d=[];a=a.crs||[];for(var h=0,g=a.length;h<g;h++)c._register(a[h]),d.push(a[h].value);k(m,b,{success:!0,crsIds:d})}})},_register:function(a){var b={id:a.value,isGeographic:a.isGeographic,axesDirections:"east"===a.axisPrimary?[2,1]:[1,2],projAttributes:a.attributes,unit:a.unit,unitValue:a.unitValue};g(A).registerCRS(b);db(a)},getRegistered:function(){var a=[],b=g(A)._crsDict,c;for(c in b)B.call(b,c)&&a.push(c);return a},transform:function(a,b,c){a=a||{};var d=
g(A),e=d.getReprCode(a.sourceCrsId||this.getCurrent()),f=d.getReprCode(a.targetCrsId);a=a.points;var h,l={};a||(h="Points for transformation are not provided");h?k(q,c,{success:!1,msg:h}):d.transformPoints(e,f,a,l,function(a){a?k(m,b,{success:!0,points:a}):k(q,c,{success:!1,points:null,msg:"transformation failed"})},this);return this},equal:function(a,b){var c=g(A),d=c.getReprCode(a),c=c.getReprCode(b);return d===c}};l.ui={infoDefaults:{overflow:!0,showCounter:!0,timeout:1E4,showTitle:!0,type:"info"},
info:function(a,b){var c=typeof a===K,d=z({},c?b:a,this.infoDefaults),e=g(M),f=d.type||"info",f="show"+f.charAt(0).toUpperCase()+f.slice(1);e[f](c?a:d.message,d)},browser:{get_handle:function(){return P(/WebBrowser1$/).get_extComponent()},show:function(a,b){function c(){k(m,b,[e,a]);e.un(Ya,c,d)}var d=this,e=d.get_handle();e.on(Ya,c,d);g(p).notify("showWebBrowser",a,d)},hide:function(a,b){function c(){k(m,b,[e,a]);e.un(Za,c,d)}a=a||{};var d=this,e=d.get_handle();e.on(Za,c,d);g(p).notify("hideWebBrowser",
a,d)}},searchResultPanel:{get_handle:function(){return P(/_SearchResultPanel1$/)},displayResult:function(a){var b=g("$apollo");this.get_handle().displaySearch(a,b.getApolloFieldDefinitions())}},sidebar:{get_handle:function(){var a=P(/_InnerSidebar$/)||P(/_Sidebar$/);return a&&a.get_extComponent()},add:function(a){this.get_handle().add(a);this.get_handle().doLayout()}},toolbar:{get_handle:function(){return P(/MapToolbar$/i).get_extComponent()},add:function(a){var b=a.categoryIndex||0,c=this.get_handle().items.items[0],
b=c.items?c.items.items[b].topToolbar:c.topToolbar;Array.isArray(b)?b.push(a):b.add(a);return this}},dataView:{get_handle:function(a){a=a||{};return La(a.dataWindowId)},show:function(a){var b=this.get_handle(a);if(b){b.set_hidden(!1);a=a||{};var c=a.mapServiceId,d=a.featureClassId,c=g(v).findMapService(c).findLegendItemDefinition(d);b.selectAndAdd([c],a.options)}},hide:function(a){(a=this.get_handle(a))&&a.set_hidden(!0)},_getPluginContainer:function(){this._pluginContainer||(this._pluginContainerName=
"__apiDataViewPlugins",Type.registerNamespace(this._pluginContainerName),this._pluginContainer=(new Function("return "+this._pluginContainerName))());return this._pluginContainer},_ensurePluginsHijacked:function(){var a=g("Intergraph.WebSolutions.Core.WebClient.Controls.Plugins.DataViewControlManager"),b=this._actionsFilter,c=this,d=function(a){var d=a.getRowActionButtons;d&&(a.getRowActionButtons=function(a,e){return d.call(this,a,e).filter(b,c)})};if(!this.__hijackFlag){for(var e=0,f=a._plugins.length;e<
f;e++)a._plugins[e]._actionsFilter||d(a._plugins[e]);this.__hijackFlag=!0}},registerRowAction:function(a,b,c){Array.isArray(a)||(a=[a]);this._rowActions=this._rowActions||{};for(var d=0,e=a.length;d<e;d++){var f=a[d];if(!f.id||!f.text||typeof f.handler!==t)return k(q,c,{success:!1,message:"Missing parameters"});if(this._rowActions[f.id])return k(q,c,{success:!1,message:"Row action with id"+f.id+" is already registered"})}c=this._getPluginContainer();var h="P"+l.utils.newGuid().replace(/-/g,""),d=
[c.getName(),h].join(".");c[h]=function(){};c[h].prototype=new ab(a,this._actionsFilter,this);c[h].registerClass(d,null,g("Intergraph.WebSolutions.Core.WebClient.Controls.Plugins.IDataViewControlPlugin"));g("Intergraph.WebSolutions.Core.WebClient.Controls.Plugins.DataViewControlManager").registerPlugins([d]);a.forEach(function(a){this._rowActions[a.id]=h},this);return k(m,b,{success:!0,_classid:d})},hideRowActions:function(a,b,c){this._processRowActions(a,b,c,!0)},unhideRowActions:function(a,b,c){this._processRowActions(a,
b,c,!1)},_processRowActions:function(a,b,c,d){Array.isArray(a)||(a=[a]);this._deletedRowActions=this._deletedRowActions||{};this._ensurePluginsHijacked();for(var e=0,f=a.length;e<f;e++){if(typeof a[e]!==K){k(q,c,{message:"Invalid argument: ids"});return}this._deletedRowActions[a[e]]=d}k(m,b,{ids:a})},_actionsFilter:function(a){return!this._deletedRowActions||!this._deletedRowActions[a.id]}}};l.settings={available:{showNavigator:!0,showCrosshair:!0,showScale:!0,showCoords:!0},get:function(){var a=
{},b=g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Settings"),c;for(c in this.available)this.available[c]&&(a[c]=b.getValue(c));return a},set:function(a){a=a||{};var b=0,c,d=g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Settings");for(c in a)this.available[c]&&(d.setValue(c,a[c]),b++);0<b&&g(p).notify("settingsChanged",{},l.settings)}};l.queries={add:function(a,b,c){a=a||{};var d=!1===a.addToLegend?!1:!0,e=g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.AnalysisManager"),
f=e.findAnalysis(a.queryId)||e.findAnalysisByName(a.queryName),e=a.filters.length;if(a.mapServiceId){var h=u(a),p=h.get_id(),s=a.queryId||l.utils.newGuid(),r=a.queryName,n={firstLegendItemDefinitionId:a.featureClassId,id:s,mapServiceId:a.mapServiceId,name:r,geometry:null,parametrizedQueryId:null,firstWhereClause:"",firstWhereAttributes:[],secondBuffer:null,secondLegendItemDefinitionId:null,secondWhereAttributes:[],secondWhereClause:"",spatialOperator:null,spatialOperatorNegation:!1,maxFeatures:a.maxFeatures},
v={callback:function(a){var d=a&&!a.error;k(d?m:q,d?b:c,{success:d,analysisId:d?a.id||n.id:"",updated:a.updated},a)},doNotAddToLegend:!d,style:a.style};f&&!r&&(r=n.name=f.get_name());for(d=0;d<e;d++)"advanced"===a.filters[d].type?(n.firstWhereClause=a.filters[0].value,n.firstWhereAttributes=[]):"spatial"===a.filters[d].type?(f=a.filters[d]||{},n.spatialOperator=f.operator,n.spatialOperatorNegation=!!f.complement,n.geometry=g(I).read(a.filters[d].operands[0]),"BoundingBox"===a.filters[d].operands[0].type&&
(n.geometry.isBBox=!0),"WFS"===l.services.find({mapServiceId:a.mapServiceId})[0].get_definitionName()&&n.geometry.swapCoordinates()):(n.firstWhereAttributes=fb(a.filters[d]),n.firstWhereClause=Da(a.filters[d]));l.legend.find({mapStateId:p,id:a.queryId,name:r},function(a){a.legendItems&&a.legendItems[0]&&(a=a.legendItems[0]._.li.get_displayStyle(),v.style=n.style||a);g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.AnalysisManager").update(h,n,v)},function(){g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.AnalysisManager").update(h,
n,v)})}else e=z({},a,{},function(a,b){return typeof a[b]!==t}),l.services.add(e,function(d){d=z({},{mapServiceId:d.msId},a);l.queries.add(d,b,c)})},find:function(a,b,c){var d=a.id||a.analysisId,e=ia({key:"id",value:d},{key:"name",value:a.name}),d=a.predicate||(n(d)||n(a.name)?e:L),f=g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.AnalysisManager")._analyses,d=Object.keys(f).map(function(a){return{id:a,name:f[a].get_name()}}).filter(d).map(function(b){return new Ma({config:{mapStateId:a.mapStateId,
analysisId:b.id},portalAnalysis:f[b.id]})});0<d.length?k(m,b,{success:!0,analyses:d,analysis:d[0]}):k(q,c,{success:!1,msg:"Analysis not found."})}};Oa.prototype={findMatchingItems:function(a,b,c){var d=this,e=F();e?"ComplexData"!==a.input.type?k(q,c,{success:!1,message:"Specified input does not accept complex values"}):(a=decodeURIComponent(a.input.constraint),g(C).create({name:"ApolloSearch",body:{mapServiceId:e,action:"search",profile:"full",orderBy:"name asc",cswQuery:a,classType:!a?"com.erdas.rsp.babel.model.imagery.ImageReference":
null},callback:Pa(b,c,"results",function(a){a.process=d;return a})}).invoke()):k(q,c,{success:!1,message:"Apollo Catalog not available"})},execute:function(a,b,c){var d=F(),e=this;if(d)if(this.inputs.length!==a.inputValues.length)k(q,c,{success:!1,message:"Specified input values count does not match process inputs number"});else{for(var f=g("Intergraph.WebSolutions.Core.SDIPortal.Apollo.Common.Apollo"),h=[],m=0;m<this.inputs.length;m++){var n;n="ComplexData"===this.inputs[m].type?f.prototype.prepareInputForGeoprocessing([{json:a.inputValues[m].apollo}]):
a.inputValues[m];h.push({dataType:"ComplexData"===this.inputs[m].type?"LiteralData":this.inputs[m].type,id:this.inputs[m].name,value:n||this.inputs[m].defaultValue,valueType:"ComplexData"===this.inputs[m].type?"complex":null})}g(C).create({name:"ApolloSearch",body:{mapServiceId:d,action:"executeProcess",procId:this.id,inputs:l.utils.serialize(h)},callback:Q(b,c,function(a){return a.statusLocation},function(a){a.process=e;return a})}).invoke()}else k(q,c,{success:!1,message:"Apollo Catalog not available"})},
getStatus:function(a,b,c){var d=F();d?g(C).create({name:"ApolloSearch",body:{mapServiceId:d,action:"checkProcess",handles:l.utils.serialize([a.statusLocation])},callback:Q(b,c,function(a){return a.processes})}).invoke():k(q,c,{success:!1,message:"Apollo Catalog not available"})},describe:function(a,b){var c=F();c?g(C).create({name:"ApolloSearch",body:{mapServiceId:c,action:"describeProcess",procId:this.id},callback:Na(a,b)}).invoke():k(q,b,{success:!1,message:"Apollo Catalog not available"})}};l.processes=
{find:function(a,b){var c=F();c?g(C).create({name:"ApolloSearch",body:{mapServiceId:c,action:"getWPSCapabilities",refresh:!0},callback:Na(a,b)}).invoke():k(q,b,{success:!1,message:"Apollo Catalog not available"})},history:function(a,b){var c=F();c?g(C).create({name:"ApolloSearch",body:{mapServiceId:c,action:"getJobs"},callback:Q(a,b,function(a){return a.result})}).invoke():k(q,b,{success:!1,message:"Apollo Catalog not available"})}};l["export"]={clipZipShip:function(a,b,c){a=a||{};var d=F();d?(a=
{args:[a.clipZipShipRequest]},g(C).create({name:"ApolloSearch",query:{mapServiceId:d,action:"download"},body:{jsonData:l.utils.serialize(a)},includeCRS:!1,callback:Q(b,c,function(a){return a})}).invoke()):k(q,c,{success:!1,message:"Apollo Catalog not available"})}};l.selectedFeatures={add:function(a,b,c){var d=a.featureId,e=a.featureIds||(d?[d]:null),f=a.featureClassId,h=ea(f,a.mapServiceId);a.featureIds=a.featureIds||e;return!e&&!f&&a.type?this._addByUser(a,b,c):n(e)&&n(f)?(a=e.map(function(a){return{id:a,
selected:!0}}),g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.SelectedFeaturesManager").setSelection(h,a),g(p).notify(S,{},this),k(m,b,{success:!0,featureId:d,featureIds:e,featureClsasId:f,featureClassId:f,features:e.map(function(a){return new H({featureId:a,featureClassId:f})}),feature:n(d)?new H({featureId:d,featureClassId:f}):T})):k(q,c,{success:!1,featureClassId:f,featureIds:e})},_addByUser:function(a,b){function c(a,g,h){l.selectedFeatures.find({},function(a){k(m,b,{success:!0,featureIds:a.featureIds,
featureClassIds:a.featureClassIds})});d(a,g,h);e.unregister(S,c,f);f._registeredSelectedFeaturesChanged=!1}function d(a,b){typeof b.finishedMapOperation===N&&e.unregister("cancelMapOperation",d,f)}var e=g(p),f=this,h="selectByBbox";switch(a.type){case "Point":h="selectByPoint";break;case "LineString":h="selectByLine";break;case "Polygon":h="selectByArea";break;case "Rectangle":h="selectByBbox"}!0===f._registeredSelectedFeaturesChanged&&e.unregister(S,c,f);e.register(S,c,f);f._registeredSelectedFeaturesChanged=
!0;e.register("cancelMapOperation",d,f);e.notify(h,{mapStateId:u(a).get_id()},f)},find:function(a,b,c){a=a||{};var d=a.featureClassId,e=g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.SelectedFeaturesManager").getAllSelected();a=Object.keys(e).reduce(function(a,b){return{featureIds:a.featureIds.concat(e[b].featureIds),legendItemDefinitions:a.legendItemDefinitions.concat(e[b].legendItemDefinitions)}},{featureIds:[],legendItemDefinitions:[]});var f;if(n(d)){for(var h=0,l=a.legendItemDefinitions.length;h<
l;h++)if(a.legendItemDefinitions[h].get_id()===d){f=h;break}if(!n(f))return k(q,c,{success:!1,message:"No featureClass with that featureClassId"})}c=n(d)&&n(f);var p=a.legendItemDefinitions.map(function(a){return a.get_id()}),d=a.featureIds.map(function(a,b){return a.map(function(a){return new H({featureId:a,featureClassId:p[b]})})});return k(m,b,{success:!0,featureIds:c?a.featureIds[f]:a.featureIds,featureClassIds:p,featureClassId:c?p[f]:T,features:c?d[f]:d})},clear:function(a,b,c){a=a||{};var d=
a.featureId,e=a.featureIds||(d?[d]:null),f=a.featureClassId;a=ea(f,a.mapServiceId);n(e)&&n(f)?(c=e.map(function(a){return{id:a,selected:!1}}),g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.SelectedFeaturesManager").setSelection(a,c),g(p).notify(S,{},this),k(m,b,{success:!0,featureId:d,featureIds:e,featureClsasId:f,featureClassId:f})):g("Intergraph.WebSolutions.Core.WebClient.Platform.Data.SelectedFeaturesManager").clear()?(g(p).notify(S,{},this),k(m,b,{success:!1})):k(q,c,{success:!1})}};
l.dynamicStyles={register:function(a,b){var c={};["default","highlight","select"].forEach(function(b){typeof a[b]===t&&(c[b]=qb(u(a).get_id(),a[b]))});g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.DynamicStyleManager").register(a.featureClassId,c);k(m,b,{success:!0})},unregister:function(a,b){g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.DynamicStyleManager").unregister(a.featureClassId);k(m,b,{success:!0})}};l.dynamicFeatureEvents={register:function(a,
b){var c={};"click dbclick tooltiptext showtooltip hidetooltip over out".split(" ").forEach(function(b){typeof a[b]===t&&(c[b]=rb(u(a).get_id(),a[b]))});g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.DynamicFeatureEventManager").register(a.featureClassId,c);k(m,b,{success:!0})},unregister:function(a,b){g("Intergraph.WebSolutions.Core.WebClient.Platform.ClientScript.Draw.DynamicFeatureEventManager").unregister(a.featureClassId);k(m,b,{success:!0})}};Xa.prototype={get_id:function(){return this._.column.name},
get_name:function(){return this._.column.aliasName},get_isKey:function(){return this._.column.isKey},get_type:function(){return this._.column.type}};l.edit={getFeatureClassIds:function(a,b,c){l.services.find(a,function(a){a=a.services[0]._.ms.get_legendItemDefinitions().map(function(a){return a.get_id()});k(m,b,{success:!0,featureClassIds:a})},c)},getAttributeList:function(a,b,c){a=a||{};if(!a.featureClassId)return k(q,c,{success:!1,msg:"featureClassId not provided"});l.services.find(a,function(d){d=
d.services[0]._.ms;var c=d.findLegendItemDefinition(a.featureClassId);d.ensureColumns([c],function(){var a=c.get_columns()||[];k(m,b,{attributeList:a.map(yb)})})},c)},getAttributeValues:function(a,b,c){a=a||{};if([a.mapServiceId,a.featureClassId,a.attributeId].some(function(a){return"string"!==typeof a}))return k(q,c,{success:!1,msg:"featureClassId, attributeId and mapServiceId must be provided"});g(C).create({name:"Analyses",query:{action:"getvalues"},body:{legendItemDefinitionId:a.featureClassId,
mapServiceId:a.mapServiceId,attributeName:a.attributeId,start:a.start,limit:a.limit||20},includeCRS:!1,callback:function(a){if(!g(M).checkExecutor(a,function(){}))return k(q,c,{success:!1});a=a.get_object();return a.error?k(q,c,{success:!1}):k(m,b,{success:!0,values:a.values,total:a.total})}}).invoke()}};l.edit.features={add:function(a,b,c){ga(a,function(d){Ta(d._service,a,b,c)},c)},find:function(a,b,c){var d=u(a).get_id();if(!a.featureClassId||!a.featureIds)return k(q,c,{success:!1,msg:"featureClassId and featureIds must be provided"});
ga(a,function(e){var f=e._service.findLegendItemDefinition(a.featureClassId);f?e._service.getFeatureDataset([f],function(f){var l=f.get_featureClasses()[a.featureClassId];l.get_geometryFieldName()||(l._geometryFieldName="geometry");g(C).create({name:"InsertFeature",query:{action:"retrievefeatures",mapServiceId:e._service.get_id(),legendItemDefinitionId:a.featureClassId},body:{featureIds:JSON.stringify(a.featureIds)},mapService:e._service,callback:function(f){f=f.get_object();return!f||f.error?k(q,
c,{success:!1,msg:(f||{}).error||"Unknown error"}):k(m,b,{success:!0,features:f.map(function(a){var b=new (g(Ua))(l,a);"WFS"===e.service.definitionName&&g(A).qualifiesForSwapById(g(A).getReprCode(),"WFS",null)&&a.get_geometry.swapCoordinates();return new H({portalFeature:b,mapStateId:d})}),featureClassId:a.featureClassId})}}).invoke()},null,{empty:!0}):k(q,c,{success:!1,msg:"Feature Class not found"})})},update:function(a,b,c){ga(a,function(d){Ta(d._service,a,b,c)},c)},remove:function(a,b,c){ga(a,
function(b){b=b._service;var c=b.findLegendItemDefinition(a.featureClassId);b.removeFeaturesEx([c],[a.featureIds],function(){g(p).notify("featuresRemoved",{legendItemDefinitions:[c]})},null)},c)},importFeatureCollections:function(a,b,c){l.services.find(a,function(d){var e=xb(a.featureCollectionsData);d.service._.ms.importFeatureDataset(e,function(a){a&&0<a.length?k(m,b,{success:!0,featureClassIds:a.map(function(a){return a.get_id()})}):k(q,c,{success:!1})})},c)},exportFeatureCollections:function(a,
b,c){l.services.find(a,function(d){var e=d.service._.ms;d=a.featureClassIds;var f=l.crs.getCurrent(),h=g(A),f="WFS"===e.get_definition().name&&h.qualifiesForSwapById(f,"WFS");d=d?a.featureClassIds.map(function(a){return e.findLegendItemDefinition(a)}):e.get_legendItemDefinitions().filter(function(a){return 0===a.get_type()});e.getFeatureDataset(d,Ka({swapped:f,format:"featureCollectionsData"},b,c))},c)}};l.edit.PSS={add:function(a,b,c){var d=z({},a,{supportsEditing:!0,supportsArcGeometry:!0,supportsDataEditing:!0,
dataEditingClientSideOnly:!1,definitionName:"PersonalStorage",url:""}),e=this;l.services.add(d,function(d){a.featureClassDefinitions?e.addFeatureClasses({mapServiceId:d.msId,featureClassDefinitions:a.featureClassDefinitions},function(a){k(m,b,{success:!0,mapServiceId:d.msId,msId:d.msId,featureClassIds:a.featureClassIds})},c):k(m,b,{success:!0,mapServiceId:d.msId,msId:d.msId,featureClassIds:[]})},c)},addFeatureClasses:function(a,b,c){if(!a.featureClassDefinitions)return k(q,c,{success:!1,msg:"no featureClassDefinitions"});
for(var d=[],e=0,f=a.featureClassDefinitions.length;e<f;e++){var h=a.featureClassDefinitions[e],n=h.featureClassId||ua(),p=h.featureClassName||h.featureClassId,r=h.crs||l.crs.getCurrent(),t=h.geometryType||4,u=h.style,h=[{aliasName:"_KEY_",name:"_KEY_",type:"System.String",isKey:!0},{name:"geometry",geometryType:t}].concat(h.fields||[]),h=new (g(Wa))(h),n={id:n,name:p,type:0,validCRS:[r],columns:h.serialize(),style:{isVisible:!0,isLocatable:!0},canModifyData:!0,canDeleteData:!0,geometryType:t,defaultDisplayStyle:u};
d.push(n)}l.services.find(a,function(a){if(!a.service)return k(q,c,{success:!1,msg:"No service"});var e=d.map(function(b){return new (g("Intergraph.WebSolutions.Core.WebClient.Platform.MapServices.LegendItemDefinition"))(b,a.service._.ms)});a.service._.ms.createLegendItemDefinitions(e);return k(m,b,{success:!0,featureClassIds:d.map(function(a){return a.id})})},c)},removeFeatureClass:function(a,b,c){var d=a.featureClassId;d||k(q,c,{success:!1,msg:"No featureClassId"});this.find(a,function(a){if(a.service){var f=
a.service._.ms;a=f.findLegendItemDefinition(d);var h=function(a,c,e){e===f&&(k(m,b,{success:!0,featureClassId:d,_:{legendItemDefinitions:c.legendItemDefinitions}}),g(p).unregister("legendItemDefinitionsRemoved",h,this))};a?(f.removeLegendItemDefinitions([a]),g(p).register("legendItemDefinitionsRemoved",h,this)):k(q,c,{success:!1,msg:"Feature Class not found"})}else k(q,c,{success:!1,msg:"No service"})},c)},find:function(a,b,c){a=z({},a,{definitionName:"PersonalStorage"});l.services.find(a,b,c)},remove:function(a,
b,c){this.find(a,function(a){(a=a.service)?a.remove(b,c):k(q,c,{success:!1,msg:"No such a service"})},c)},createFromFeatureCollections:function(a,b,c){this.add({name:a.name},function(d){l.edit.features.importFeatureCollections({mapServiceId:d.mapServiceId,featureCollectionsData:a.featureCollectionsData},function(a){l.legend.add({mapServiceId:d.mapServiceId,ids:a.featureClassIds},b,c)},c)},c)}}})(window);
